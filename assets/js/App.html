<script>
    import Codemirror from "./codemirror/Codemirror.html"

	let text, result, data
	let loading = false

	function run_query(){
		loading = true
		fetch('/api/run', {
            method: 'POST',
            headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				'x-csrf-token': window.csrfToken
			},
            body: JSON.stringify({ text })
        })
        .then(resp => resp.json())
        .then(s => {
			console.log(s)
		})
		.then( _ => loading = false)
	}

	function on_change(cm){
		text = cm.getValue()
	}
</script>

<h1>Hello world!</h1>
<Codemirror mode="python" on_change={on_change} submit_f={run_query}></Codemirror>
<a on:click={run_query}>Run Query</a>
